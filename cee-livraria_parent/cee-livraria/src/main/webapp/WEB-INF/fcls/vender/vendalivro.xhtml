<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" 
	xmlns:h="http://java.sun.com/jsf/html" 
	xmlns:f="http://java.sun.com/jsf/core" 
	xmlns:p="http://primefaces.prime.com.tr/ui" 
	xmlns:ui="http://java.sun.com/jsf/facelets" 
	xmlns:plcf="http://www.powerlogic.com.br/plcf" 
	xmlns:tr="http://myfaces.apache.org/trinidad" 
	xmlns:trh="http://myfaces.apache.org/trinidad/html">  
	<ui:composition template="/fcls/template/PlcGeralTemplate.xhtml"> 
		<ui:define name="plc-corpo-formulario"> 
<script type="text/javascript" language="javascript">

//<![CDATA[

var hasOwnProperty = Object.prototype.hasOwnProperty;

function is_empty(obj) {

    // null and undefined are empty
    if (obj == null) return true;
    // Assume if it has a length property with a non-zero value
    // that that property is correct.
    if (obj.length && obj.length > 0)    return false;
    if (obj.length === 0)  return true;

    for (var key in obj) {
        if (hasOwnProperty.call(obj, key))    return false;
    }

    return true;
}

// Deprecated -- o calculo agora acontece no MB (VendaLivroMB)
function calculaTotal(indice) {

	if (indice != null) {
		var i = indice - 1
		var qt = document.getElementById('corpo:formulario:vendalivro:' + i + ':quantidade')
		var vl = document.getElementById('corpo:formulario:vendalivro:' + i + ':valorUnitario')
		var vt = document.getElementById('corpo:formulario:vendalivro:' + i + ':valorTotal')
		var vg = document.getElementById('corpo:formulario:valorTotalGeral')
		
		if (!is_empty(qt.value) && !is_empty(vl.value)) {

			var nqt = parseInt(qt.value.replace('.', ''))
			var nvl = parseFloat(vl.value.replace(',', '.'))
			var nvt = nvl * nqt
			vt.value = String(nvt.toFixed(2)).replace('.', ',')

			// Calculo do Valor Total Geral
			if (is_empty(vg.value)) {
				vg.value = vt.value
			} else {
				var nvg = parseFloat(vg.value.replace(',', '.'))
				nvg = nvt + nvg
				vg.value = String(nvg.toFixed(2)).replace('.', ',')
			}

		} else {
			vt.value = '0,00'	 
		}
	}
}

function formataVlUnitario(indice) {

	if (indice != null) {
		var i = indice - 1
		var vl = document.getElementById('corpo:formulario:vendalivro:' + i + ':valorUnitario')
		
		if (!is_empty(vl.value)) {
			var nvl = parseFloat(vl.value.replace(',', '.'))
			vl.value = String(nvl.toFixed(2)).replace('.', ',')	 
		}	
	}
}

//]]>
</script>	
			<div id="plc-corpo-formulario" class="plc-corpo-formulario plc-form-tabular"> 
				<fieldset class="plc-fieldset"> 
					<legend class="plc-fieldset-legend">#{msg['vendalivro.titulo']}</legend>  
					<plcf:iteracao var="vendalivro" id="vendalivro" value="#{vendalivroLista.itensPlc}" columnClasses="celulaFormulario" headerClass="celulaFormulario"> 
						<h:column> 
							<h:outputText value="#{rowCounter.index}."/>
						</h:column>  
						<h:column rendered="#{empty requestScope.visualizaDocumentoPlc}"> 
							<f:facet name="header">
								<plcf:tituloExclusao>Exc.</plcf:tituloExclusao>
							</f:facet>  
							<span class="celulaFormularioCaixaMarcacao">
								<plcf:caixaExclusao id="indExcPlc" value="#{vendalivro.indExcPlc}"/>
							</span> 
						</h:column>  
						<h:column> 
							<f:facet name="header">
								<plcf:titulo value="#{msg['label.livro']}"/>
							</f:facet>
							<plcf:vinculado id="livro" value="#{vendalivro.livro}" 
								propSelPop="livro" idExibe="S" 
								idTamanho="12" lookupTamanho="60"
								larg="1200" alt="800"
								autoRecuperacaoPropriedade="codigoBarras"
								autoComplete="true" evento="y"
								idSomenteLeitura="N" autoRecuperacaoClasse="com.cee.livraria.entity.LivroEntity" 
								actionSel="livrosel" modal="S" ajudaChave="ajuda.livro" 
								onkeydown="selecionaPorTecla(event,this);" 
								riaUsa="autocomplete(url='/cee-livraria/soa/service/autocomplete.livro?q=titulo')"/> 
						</h:column>  
						<h:column> 
							<f:facet name="header">
								<plcf:titulo value="#{msg['label.quantidade']}"/>
							</f:facet>
							<plcf:numerico id="quantidade" value="#{vendalivro.quantidade}" numCasas="0" onfocus="formataVlUnitario(#{rowCounter.indexIteration})" tamanho="6" ajudaChave="ajuda.quantidade"/> 
						</h:column>  
						<h:column> 
							<f:facet name="header">
								<plcf:titulo value="#{msg['label.nomeTabela']}"/>
							</f:facet>  
							<plcf:texto id="nomeTabela" value="#{vendalivro.nomeTabela}" somenteLeitura="S" tamanho="15" ajudaChave="ajuda.nomeTabela"/> 
						</h:column>  
						<h:column> 
							<f:facet name="header">
								<plcf:titulo value="#{msg['label.valorUnitario']}"/>
							</f:facet>  
							<plcf:numerico id="valorUnitario" value="#{vendalivro.valorUnitario}" somenteLeitura="S" tamanho="10" ajudaChave="ajuda.valorUnitario"/> 
						</h:column>  
						<h:column> 
							<f:facet name="header">
								<plcf:titulo value="#{msg['label.valorTotal']}"/>
							</f:facet>  
							<plcf:numerico id="valorTotal" value="#{vendalivro.valorTotal}" tamanho="10" somenteLeitura="S" ajudaChave="ajuda.valorTotal"/> 
						</h:column> 
					</plcf:iteracao> 
				</fieldset> 
			</div> 
			<div id="plc-corpo-formulario2" class="plc-corpo-formulario plc-form-tabular"> 
				<fieldset class="plc-fieldset"> 
					<legend class="plc-fieldset-legend">#{msg['vendalivro.pagamento']}</legend>  
					<plcf:iteracao var="pagamento" id="pagamento" value="#{pagamentoLista.itens}" columnClasses="celulaFormulario" headerClass="celulaFormulario"> 
						<h:column> 
							<f:facet name="header">
								<plcf:titulo value="#{msg['label.valorTotalGeral']}"/>  
							</f:facet>  
							<plcf:numerico id="valorTotalGeral" value="#{pagamento.valor}" tamanho="8" numCasas="2" somenteLeitura="N" ajudaChave="ajuda.valorTotalGeral"/> 
						</h:column>  
						<h:column> 
							<f:facet name="header">
								<plcf:titulo value="#{msg['label.formaPagLivroGeral']}"/>  
							</f:facet>  
							<plcf:comboDinamico id="formaPagto" value="#{pagamento.formaPagto}" dominio="FormaPagtoEntity" exibeBranco="S" ajudaChave="ajuda.formaPagtoGeral"/> 
						</h:column>  
					</plcf:iteracao> 
				</fieldset> 
			</div> 
		</ui:define> 
	</ui:composition> 
</html>
